#!/usr/bin/env ruby


# The first matching rule is used:

# layout '*', :erb
# layout '/default/', :slim
# layout '/default/', :haml, format: :html5
# layout %r{^/_.+/$}, :erb
# /default/ may be layouts/default.with-any-extension

# all unmatched layouts will be compiled using filter determined by extension:

FakeItems.new('layouts').items.each do |item|
  layout item.identifier, FilterFor[item.file]
end


# compile default files created by nanoc:

compile('/'){ layout 'default' }
route('/'){'/index.html'}

compile('/stylesheet/'){}
route('/stylesheet/'){'/style.css'}


content_items = FakeItems.new('content').items
classes = ItemClass.new

content_items.select! do |item|
  klass = classes[item]
  item[:object] = klass.new(item) if klass
end


content_items.each do |item|
  compile (+item).identifier do
    filter :erb
    layout 'default'
  end
  route (+item).identifier do
    (+item).route
  end  
end